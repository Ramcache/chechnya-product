<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>WebSocket Заказы</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
        }
        #orders {
            margin-top: 20px;
        }
        .order {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 6px;
            background-color: #f9f9f9;
        }
        .items {
            margin-top: 10px;
            padding-left: 20px;
        }
    </style>
</head>
<body>
<h1>🧾 Новые заказы через WebSocket</h1>
<div id="status">🔄 Подключение...</div>
<div id="orders"></div>

<script>
    const statusEl = document.getElementById("status");
    const ordersEl = document.getElementById("orders");

    // const socket = new WebSocket("wss://chechnya-product.ru/ws/orders");
    const socket = new WebSocket("ws://localhost:8080/ws/orders");

    socket.onopen = () => {
        statusEl.textContent = "✅ Подключено к WebSocket";
    };

    socket.onclose = () => {
        statusEl.textContent = "❌ Соединение закрыто";
    };

    socket.onerror = (err) => {
        statusEl.textContent = "⚠️ Ошибка WebSocket";
        console.error("WebSocket error:", err);
    };

    socket.onmessage = (event) => {
        const message = JSON.parse(event.data);
        console.log("📨 Получено сообщение:", message);

        if (message.type === "new_order" || message.type === "status_update") {
            const order = message.order;

            const div = document.createElement("div");
            div.className = "order";

            const itemsHTML = order.items?.map(item => `
          <li>${item.name || "Без названия"} — ${item.quantity} x ${item.price}₽</li>
        `).join("") || "<li>Нет товаров</li>";

            div.innerHTML = `
          <strong>🆔 Заказ #${order.id}</strong><br>
          👤 Владелец: ${order.owner_id}<br>
          💬 Имя: ${order.name || "—"}<br>
          🏠 Адрес: ${order.address || "—"}<br>
          🚚 Доставка: ${order.delivery_type}<br>
          💳 Оплата: ${order.payment_type}<br>
          💰 Сумма: ${order.total} ₽<br>
          📅 Время: ${order.created_at}<br>
          <div class="items"><strong>🛒 Товары:</strong><ul>${itemsHTML}</ul></div>
        `;

            ordersEl.prepend(div);
        }
    };
</script>
</body>
</html>
