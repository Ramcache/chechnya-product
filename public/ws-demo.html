<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>üì¶ WS –∑–∞–∫–∞–∑—ã</title>
</head>
<body>
<h1>üì¶ –ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã</h1>
<ul id="orders"></ul>

<script>
    const orderList = document.getElementById("orders");

    // üëâ –í–°–¢–ê–í–¨ —Å—é–¥–∞ —Å–≤–æ–π JWT —Ç–æ–∫–µ–Ω –∞–¥–º–∏–Ω–∞
    const token = "Bearer YOUR_ADMIN_JWT_TOKEN_HERE";

    // üîΩ –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –∑–∞–∫–∞–∑–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    fetch("http://localhost:8080/api/admin/orders", {
        headers: {
            "Authorization": token
        }
    })
        .then(response => response.json())
        .then(data => {
            data.reverse().forEach(order => renderOrder(order));
        })
        .catch(error => {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∑–∞–∫–∞–∑–æ–≤:", error);
        });

    // üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ WebSocket
    const socket = new WebSocket("ws://localhost:8080/ws/orders");

    socket.onopen = () => {
        console.log("‚úÖ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ");
    };

    socket.onmessage = (event) => {
        const data = JSON.parse(event.data);
        if (data.type === "new_order") {
            renderOrder(data.order);
        }
    };

    socket.onerror = (err) => {
        console.error("‚ùå –û—à–∏–±–∫–∞ WebSocket:", err);
    };

    function renderOrder(order) {
        const item = document.createElement("li");
        item.textContent = `#${order.id}: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${order.owner_id}, —Å—É–º–º–∞ ${order.total}`;
        orderList.prepend(item);
    }
</script>
</body>
</html>
