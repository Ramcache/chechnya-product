<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>WebSocket Ğ—Ğ°ĞºĞ°Ğ·Ñ‹</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
        }
        #orders {
            margin-top: 20px;
        }
        .order {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 6px;
            background-color: #f9f9f9;
        }
        .items {
            margin-top: 10px;
            padding-left: 20px;
        }
    </style>
</head>
<body>
<h1>ğŸ§¾ ĞĞ¾Ğ²Ñ‹Ğµ Ğ·Ğ°ĞºĞ°Ğ·Ñ‹ Ñ‡ĞµÑ€ĞµĞ· WebSocket</h1>
<div id="status">ğŸ”„ ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ...</div>
<div id="orders"></div>

<script>
    const statusEl = document.getElementById("status");
    const ordersEl = document.getElementById("orders");

    // const socket = new WebSocket("wss://chechnya-product.ru/ws/orders");
    const socket = new WebSocket("ws://localhost:8080/ws/orders");

    socket.onopen = () => {
        statusEl.textContent = "âœ… ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾ Ğº WebSocket";
    };

    socket.onclose = () => {
        statusEl.textContent = "âŒ Ğ¡Ğ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¾";
    };

    socket.onerror = (err) => {
        statusEl.textContent = "âš ï¸ ĞÑˆĞ¸Ğ±ĞºĞ° WebSocket";
        console.error("WebSocket error:", err);
    };

    socket.onmessage = (event) => {
        const message = JSON.parse(event.data);
        console.log("ğŸ“¨ ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ:", message);

        if (message.type === "new_order" || message.type === "status_update") {
            const order = message.order;

            const div = document.createElement("div");
            div.className = "order";

            const itemsHTML = order.items?.map(item => `
          <li>${item.name || "Ğ‘ĞµĞ· Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ"} â€” ${item.quantity} x ${item.price}â‚½</li>
        `).join("") || "<li>ĞĞµÑ‚ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²</li>";

            div.innerHTML = `
          <strong>ğŸ†” Ğ—Ğ°ĞºĞ°Ğ· #${order.id}</strong><br>
          ğŸ‘¤ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ†: ${order.owner_id}<br>
          ğŸ’¬ Ğ˜Ğ¼Ñ: ${order.name || "â€”"}<br>
          ğŸ  ĞĞ´Ñ€ĞµÑ: ${order.address || "â€”"}<br>
          ğŸšš Ğ”Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ°: ${order.delivery_type}<br>
          ğŸ’³ ĞĞ¿Ğ»Ğ°Ñ‚Ğ°: ${order.payment_type}<br>
          ğŸ’° Ğ¡ÑƒĞ¼Ğ¼Ğ°: ${order.total} â‚½<br>
          ğŸ“… Ğ’Ñ€ĞµĞ¼Ñ: ${order.created_at}<br>
          <div class="items"><strong>ğŸ›’ Ğ¢Ğ¾Ğ²Ğ°Ñ€Ñ‹:</strong><ul>${itemsHTML}</ul></div>
        `;

            ordersEl.prepend(div);
        }
    };
</script>
</body>
</html>
